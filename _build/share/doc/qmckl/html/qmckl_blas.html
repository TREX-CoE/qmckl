<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-12-15 Mon 16:47 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BLAS functions</title>
<meta name="author" content="TREX CoE" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" title="Standard" href="qmckl.css" type="text/css" />

<script src="org-info.js">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
// @license-end
</script>

<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
org_html_manager.set("TOC_DEPTH", "4");
org_html_manager.set("LINK_HOME", "index.html");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
// @license-end
</script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">BLAS functions</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd33772a">-</a></li>
<li><a href="#org1554768">1. Data types</a>
<ul>
<li><a href="#org7e9b565">1.1. Vector</a>
<ul>
<li><a href="#org7bacace">1.1.1. Allocation and deallocation</a></li>
</ul>
</li>
<li><a href="#orgafe047e">1.2. Matrix</a></li>
<li><a href="#org2a8479a">1.3. Tensor</a></li>
<li><a href="#org9b3a323">1.4. Reshaping</a>
<ul>
<li><a href="#org59a114f">1.4.1. Vector -&gt; Matrix</a></li>
<li><a href="#org41d4209">1.4.2. Vector -&gt; Tensor</a></li>
<li><a href="#org7b17126">1.4.3. Matrix -&gt; Vector</a></li>
<li><a href="#org51a2af0">1.4.4. Matrix -&gt; Tensor</a></li>
<li><a href="#orgf9ff22f">1.4.5. Tensor -&gt; Vector</a></li>
<li><a href="#org8ee1385">1.4.6. Tensor -&gt; Matrix</a></li>
</ul>
</li>
<li><a href="#org0d31a41">1.5. Access macros</a></li>
<li><a href="#org11df0bf">1.6. Set all elements</a>
<ul>
<li><a href="#org328f2c1">1.6.1. Vector</a></li>
<li><a href="#org24a1ac6">1.6.2. Matrix</a></li>
<li><a href="#orge1d2c89">1.6.3. Tensor</a></li>
</ul>
</li>
<li><a href="#org839f7af">1.7. Copy to/from to <code>double*</code></a></li>
<li><a href="#org4eb777e">1.8. Allocate and copy to <code>double*</code></a></li>
</ul>
</li>
<li><a href="#org1f73ccc">2. Matrix operations</a>
<ul>
<li><a href="#orgf9d58ca">2.1. <code>qmckl_dgemm</code></a></li>
<li><a href="#orgf33bd8e">2.2. <code>qmckl_dgemm_safe</code></a></li>
<li><a href="#org88e72a6">2.3. <code>qmckl_matmul</code></a></li>
<li><a href="#org14347f7">2.4. <code>qmckl_adjugate</code></a></li>
<li><a href="#org5a203eb">2.5. <code>qmckl_adjugate_safe</code></a>
<ul>
<li><a href="#org871eb4c">2.5.1. C interface</a></li>
</ul>
</li>
<li><a href="#orga82ba36">2.6. <code>qmckl_transpose</code></a></li>
<li><a href="#org5663513">2.7. <code>qmckl_dgemm_sparse_nn</code></a></li>
<li><a href="#org012384f">2.8. <code>qmckl_dgemm_sparse_b_nn</code></a></li>
<li><a href="#orge82d772">2.9. <code>qmckl_dgemv</code></a></li>
<li><a href="#org7204053">2.10. <code>qmckl_dger</code></a></li>
</ul>
</li>
<li><a href="#org252c536">3. Utilities</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgd33772a" class="outline-2">
<h2 id="orgd33772a">-</h2>
<div class="outline-text-2" id="text-orgd33772a">
<p>
This module defines basic linear algebra data types and operations used
throughout the QMCkl library. These fundamental structures and operations
provide the mathematical foundation for quantum chemistry calculations,
enabling efficient manipulation of vectors and matrices.
</p>

<p>
The data types defined here are deliberately kept private to the library
implementation. This design choice allows high-performance computing (HPC)
implementations to use whatever underlying data structures they prefer -
whether standard arrays, GPU memory buffers, distributed arrays, or other
specialized formats - without affecting the public API.
</p>

<p>
These data types are expected to be used internally within QMCkl for
intermediate calculations and data organization. They are not intended to 
be passed to or from external codes, maintaining a clean separation between
the library's internal implementation and its public interface.
</p>
</div>
</div>

<div id="outline-container-org1554768" class="outline-2">
<h2 id="org1554768"><span class="section-number-2">1.</span> Data types</h2>
<div class="outline-text-2" id="text-1">
<p>
The library defines standard mathematical objects as structured data types
with associated operations. These types encapsulate both the data and its
metadata (such as dimensions), enabling type-safe and dimension-aware
computations.
</p>

<p>
These data types are used internally in QMCkl, so the current section
is intended for QMCkl developers.
</p>
</div>

<div id="outline-container-org7e9b565" class="outline-3">
<h3 id="org7e9b565"><span class="section-number-3">1.1.</span> Vector</h3>
<div class="outline-text-3" id="text-1-1">
<p>
A vector represents a one-dimensional array of double-precision floating-point
numbers. The structure includes both the data pointer and the size, ensuring
that operations on vectors can verify dimensional compatibility.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>size</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">Dimension of the vector</td>
</tr>

<tr>
<td class="org-left"><code>data</code></td>
<td class="org-left"><code>double*</code></td>
<td class="org-left">Elements</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #a020f0;">typedef</span> <span style="color: #a020f0;">struct</span> <span style="color: #228b22;">qmckl_vector</span> {
  <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">restrict</span> <span style="color: #a0522d;">data</span>;
  <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size</span>;
} <span style="color: #228b22;">qmckl_vector</span>;
</pre>
</div>
</div>

<div id="outline-container-org7bacace" class="outline-4">
<h4 id="org7bacace"><span class="section-number-4">1.1.1.</span> Allocation and deallocation</h4>
<div class="outline-text-4" id="text-1-1-1">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_vector</span>
<span style="color: #0000ff;">qmckl_vector_alloc</span>( <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                    <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size</span>);
</pre>
</div>

<p>
Allocates a new vector of the specified size. The function returns a
<code>qmckl_vector</code> structure containing the allocated memory and size information.
If the allocation fails, the returned vector will have a size of zero,
which can be checked by the caller to detect allocation failures.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_vector_free</span>( <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                   <span style="color: #228b22;">qmckl_vector</span>* <span style="color: #a0522d;">vector</span>);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgafe047e" class="outline-3">
<h3 id="orgafe047e"><span class="section-number-3">1.2.</span> Matrix</h3>
<div class="outline-text-3" id="text-1-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>size</code></td>
<td class="org-left"><code>int64_t[2]</code></td>
<td class="org-left">Dimension of each component</td>
</tr>

<tr>
<td class="org-left"><code>data</code></td>
<td class="org-left"><code>double*</code></td>
<td class="org-left">Elements</td>
</tr>
</tbody>
</table>

<p>
The dimensions use Fortran ordering: two elements differing by one
in the first dimension are consecutive in memory.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #a020f0;">typedef</span> <span style="color: #a020f0;">struct</span> <span style="color: #228b22;">qmckl_matrix</span> {
  <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">restrict</span> <span style="color: #a0522d;">data</span>;
  <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size</span>[2];
} <span style="color: #228b22;">qmckl_matrix</span>;
</pre>
</div>


<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_matrix</span>
<span style="color: #0000ff;">qmckl_matrix_alloc</span>( <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                    <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size1</span>,
                    <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size2</span>);
</pre>
</div>

<p>
Allocates a new matrix. If the allocation failed the sizes are zero.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_matrix_free</span>( <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                   <span style="color: #228b22;">qmckl_matrix</span>* <span style="color: #a0522d;">matrix</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a8479a" class="outline-3">
<h3 id="org2a8479a"><span class="section-number-3">1.3.</span> Tensor</h3>
<div class="outline-text-3" id="text-1-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>order</code></td>
<td class="org-left"><code>int32_t</code></td>
<td class="org-left">Order of the tensor</td>
</tr>

<tr>
<td class="org-left"><code>size</code></td>
<td class="org-left"><code>int64_t[QMCKL_TENSOR_ORDER_MAX]</code></td>
<td class="org-left">Dimension of each component</td>
</tr>

<tr>
<td class="org-left"><code>data</code></td>
<td class="org-left"><code>double*</code></td>
<td class="org-left">Elements</td>
</tr>
</tbody>
</table>

<p>
The dimensions use Fortran ordering: two elements differing by one
in the first dimension are consecutive in memory.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #483d8b;">#define</span> <span style="color: #a0522d;">QMCKL_TENSOR_ORDER_MAX</span> 16

<span style="color: #a020f0;">typedef</span> <span style="color: #a020f0;">struct</span> <span style="color: #228b22;">qmckl_tensor</span> {
  <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">restrict</span> <span style="color: #a0522d;">data</span>;
  <span style="color: #228b22;">int32_t</span> <span style="color: #a0522d;">order</span>;
  <span style="color: #228b22;">int32_t</span> <span style="color: #a0522d;">__space__</span>;
  <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size</span>[QMCKL_TENSOR_ORDER_MAX];
} <span style="color: #228b22;">qmckl_tensor</span>;
</pre>
</div>


<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_tensor</span>
<span style="color: #0000ff;">qmckl_tensor_alloc</span>( <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                    <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int32_t</span> <span style="color: #a0522d;">order</span>,
                    <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span>* <span style="color: #a0522d;">size</span>);
</pre>
</div>

<p>
Allocates memory for a tensor. If the allocation failed, the size
is zero.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_tensor_free</span> (<span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                   <span style="color: #228b22;">qmckl_tensor</span>* <span style="color: #a0522d;">tensor</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b3a323" class="outline-3">
<h3 id="org9b3a323"><span class="section-number-3">1.4.</span> Reshaping</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Reshaping occurs in-place and the pointer to the data is copied.
</p>
</div>

<div id="outline-container-org59a114f" class="outline-4">
<h4 id="org59a114f"><span class="section-number-4">1.4.1.</span> Vector -&gt; Matrix</h4>
<div class="outline-text-4" id="text-1-4-1">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_matrix</span>
<span style="color: #0000ff;">qmckl_matrix_of_vector</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_vector</span> <span style="color: #a0522d;">vector</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size1</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size2</span>);
</pre>
</div>

<p>
Reshapes a vector into a matrix.
</p>
</div>
</div>

<div id="outline-container-org41d4209" class="outline-4">
<h4 id="org41d4209"><span class="section-number-4">1.4.2.</span> Vector -&gt; Tensor</h4>
<div class="outline-text-4" id="text-1-4-2">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_tensor</span>
<span style="color: #0000ff;">qmckl_tensor_of_vector</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_vector</span> <span style="color: #a0522d;">vector</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int32_t</span> <span style="color: #a0522d;">order</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span>* <span style="color: #a0522d;">size</span>);
</pre>
</div>

<p>
Reshapes a vector into a tensor.
</p>
</div>
</div>

<div id="outline-container-org7b17126" class="outline-4">
<h4 id="org7b17126"><span class="section-number-4">1.4.3.</span> Matrix -&gt; Vector</h4>
<div class="outline-text-4" id="text-1-4-3">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_vector</span>
<span style="color: #0000ff;">qmckl_vector_of_matrix</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">matrix</span>);
</pre>
</div>

<p>
Reshapes a matrix into a vector.
</p>
</div>
</div>

<div id="outline-container-org51a2af0" class="outline-4">
<h4 id="org51a2af0"><span class="section-number-4">1.4.4.</span> Matrix -&gt; Tensor</h4>
<div class="outline-text-4" id="text-1-4-4">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_tensor</span>
<span style="color: #0000ff;">qmckl_tensor_of_matrix</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">matrix</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int32_t</span> <span style="color: #a0522d;">order</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span>* <span style="color: #a0522d;">size</span>);
</pre>
</div>

<p>
Reshapes a matrix into a tensor.
</p>
</div>
</div>

<div id="outline-container-orgf9ff22f" class="outline-4">
<h4 id="orgf9ff22f"><span class="section-number-4">1.4.5.</span> Tensor -&gt; Vector</h4>
<div class="outline-text-4" id="text-1-4-5">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_vector</span>
<span style="color: #0000ff;">qmckl_vector_of_tensor</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">tensor</span>);
</pre>
</div>

<p>
Reshapes a tensor into a vector.
</p>
</div>
</div>

<div id="outline-container-org8ee1385" class="outline-4">
<h4 id="org8ee1385"><span class="section-number-4">1.4.6.</span> Tensor -&gt; Matrix</h4>
<div class="outline-text-4" id="text-1-4-6">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_matrix</span>
<span style="color: #0000ff;">qmckl_matrix_of_tensor</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">tensor</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size1</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size2</span>);
</pre>
</div>

<p>
Reshapes a tensor into a vector.
</p>
</div>
</div>
</div>

<div id="outline-container-org0d31a41" class="outline-3">
<h3 id="org0d31a41"><span class="section-number-3">1.5.</span> Access macros</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Macros are provided to ease the access to vectors, matrices and
tensors. Matrices use column-major ordering, as in Fortran.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">double</span> <span style="color: #0000ff;">qmckl_vec</span> (<span style="color: #228b22;">qmckl_vector</span> <span style="color: #a0522d;">v</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">i</span>);           //  <span style="color: #b22222;">v[i]</span>
<span style="color: #228b22;">double</span> <span style="color: #0000ff;">qmckl_mat</span> (<span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">m</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">i</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">j</span>) // <span style="color: #b22222;">m[j][i]</span>

<span style="color: #228b22;">double</span> <span style="color: #0000ff;">qmckl_ten3</span>(<span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">t</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">i</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">j</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">k</span>); // <span style="color: #b22222;">t[k][j][i]</span>
<span style="color: #228b22;">double</span> <span style="color: #0000ff;">qmckl_ten4</span>(<span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">t</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">i</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">j</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">k</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">l</span>);
<span style="color: #228b22;">double</span> <span style="color: #0000ff;">qmckl_ten5</span>(<span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">t</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">i</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">j</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">k</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">l</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">m</span>);
<span style="color: #228b22;">double</span> <span style="color: #0000ff;">qmckl_ten6</span>(<span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">t</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">i</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">j</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">k</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">l</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">m</span>, <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">n</span>);
...
</pre>
</div>

<p>
For example:
</p>
</div>
</div>

<div id="outline-container-org11df0bf" class="outline-3">
<h3 id="org11df0bf"><span class="section-number-3">1.6.</span> Set all elements</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-org328f2c1" class="outline-4">
<h4 id="org328f2c1"><span class="section-number-4">1.6.1.</span> Vector</h4>
<div class="outline-text-4" id="text-1-6-1">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_vector</span>
<span style="color: #0000ff;">qmckl_vector_set</span>(<span style="color: #228b22;">qmckl_vector</span> <span style="color: #a0522d;">vector</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">value</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-org24a1ac6" class="outline-4">
<h4 id="org24a1ac6"><span class="section-number-4">1.6.2.</span> Matrix</h4>
<div class="outline-text-4" id="text-1-6-2">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_matrix</span>
<span style="color: #0000ff;">qmckl_matrix_set</span>(<span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">matrix</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">value</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1d2c89" class="outline-4">
<h4 id="orge1d2c89"><span class="section-number-4">1.6.3.</span> Tensor</h4>
<div class="outline-text-4" id="text-1-6-3">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_tensor</span>
<span style="color: #0000ff;">qmckl_tensor_set</span>(<span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">tensor</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">value</span>);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org839f7af" class="outline-3">
<h3 id="org839f7af"><span class="section-number-3">1.7.</span> Copy to/from to <code>double*</code></h3>
<div class="outline-text-3" id="text-1-7">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_double_of_vector</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_vector</span> <span style="color: #a0522d;">vector</span>,
                       <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">target</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max</span>);
</pre>
</div>

<p>
Converts a vector to a <code>double*</code>.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_double_of_matrix</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">matrix</span>,
                       <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">target</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max</span>);
</pre>
</div>

<p>
Converts a matrix to a <code>double*</code>.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_double_of_tensor</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">tensor</span>,
                       <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">target</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max</span>);
</pre>
</div>

<p>
Converts a tensor to a <code>double*</code>.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_vector_of_double</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">target</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max</span>,
                       <span style="color: #228b22;">qmckl_vector</span>* <span style="color: #a0522d;">vector</span>);
</pre>
</div>

<p>
Converts a <code>double*</code> to a vector.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_matrix_of_double</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">target</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max</span>,
                       <span style="color: #228b22;">qmckl_matrix</span>* <span style="color: #a0522d;">matrix</span>);
</pre>
</div>

<p>
Converts a <code>double*</code> to a matrix.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span>
<span style="color: #0000ff;">qmckl_tensor_of_double</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">target</span>,
                       <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max</span>,
                       <span style="color: #228b22;">qmckl_tensor</span>* <span style="color: #a0522d;">tensor</span>);
</pre>
</div>

<p>
Converts a <code>double*</code> to a tensor.
</p>
</div>
</div>

<div id="outline-container-org4eb777e" class="outline-3">
<h3 id="org4eb777e"><span class="section-number-3">1.8.</span> Allocate and copy to <code>double*</code></h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">double</span>* <span style="color: #0000ff;">qmckl_alloc_double_of_vector</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                                     <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_vector</span> <span style="color: #a0522d;">vector</span>);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">double</span>* <span style="color: #0000ff;">qmckl_alloc_double_of_matrix</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                                     <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">matrix</span>);
</pre>
</div>


<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">double</span>* <span style="color: #0000ff;">qmckl_alloc_double_of_tensor</span>(<span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
                                     <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_tensor</span> <span style="color: #a0522d;">tensor</span>);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1f73ccc" class="outline-2">
<h2 id="org1f73ccc"><span class="section-number-2">2.</span> Matrix operations</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgf9d58ca" class="outline-3">
<h3 id="orgf9d58ca"><span class="section-number-3">2.1.</span> <code>qmckl_dgemm</code></h3>
<div class="outline-text-3" id="text-2-1">
<p>
Matrix multiplication with a BLAS interface:
</p>

<p>
\[
   C_{ij} = \beta C_{ij} + \alpha \sum_{k} A_{ik} \cdot B_{kj}
   \]
</p>

<table id="org04f8298" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>TransA</code></td>
<td class="org-left"><code>char</code></td>
<td class="org-left">in</td>
<td class="org-left">'T' is transposed</td>
</tr>

<tr>
<td class="org-left"><code>TransB</code></td>
<td class="org-left"><code>char</code></td>
<td class="org-left">in</td>
<td class="org-left">'T' is transposed</td>
</tr>

<tr>
<td class="org-left"><code>m</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>k</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>alpha</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">&alpha;</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>double[][lda]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>lda</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>A</code></td>
</tr>

<tr>
<td class="org-left"><code>B</code></td>
<td class="org-left"><code>double[][ldb]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the matrix \(B\)</td>
</tr>

<tr>
<td class="org-left"><code>ldb</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>B</code></td>
</tr>

<tr>
<td class="org-left"><code>beta</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">&beta;</td>
</tr>

<tr>
<td class="org-left"><code>C</code></td>
<td class="org-left"><code>double[][ldc]</code></td>
<td class="org-left">out</td>
<td class="org-left">Array containing the matrix \(C\)</td>
</tr>

<tr>
<td class="org-left"><code>ldc</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>C</code></td>
</tr>
</tbody>
</table>

<p>
Requirements:
</p>

<ul class="org-ul">
<li><code>context</code> is not <code>QMCKL_NULL_CONTEXT</code></li>
<li><code>m &gt; 0</code></li>
<li><code>n &gt; 0</code></li>
<li><code>k &gt; 0</code></li>
<li><code>lda &gt;= m</code></li>
<li><code>ldb &gt;= n</code></li>
<li><code>ldc &gt;= n</code></li>
<li><code>A</code> is allocated with at least \(m \times k \times 8\) bytes</li>
<li><code>B</code> is allocated with at least \(k \times n \times 8\) bytes</li>
<li><code>C</code> is allocated with at least \(m \times n \times 8\) bytes</li>
</ul>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span> <span style="color: #0000ff;">qmckl_dgemm</span> (
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">TransA</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">TransB</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">m</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">n</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">k</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">alpha</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">lda</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">B</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">ldb</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">beta</span>,
      <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">C</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">ldc</span> ); 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf33bd8e" class="outline-3">
<h3 id="orgf33bd8e"><span class="section-number-3">2.2.</span> <code>qmckl_dgemm_safe</code></h3>
<div class="outline-text-3" id="text-2-2">
<p>
"Size-safe" proxy function with the same functionality as <code>qmckl_dgemm</code>
but with 3 additional arguments. These arguments <code>size_max_M</code> (where <code>M</code> is a matix)
are required primarily for the Python API, where compatibility with
NumPy arrays implies that sizes of the input and output arrays are provided.
</p>

<table id="org5c2936e" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>TransA</code></td>
<td class="org-left"><code>char</code></td>
<td class="org-left">in</td>
<td class="org-left">'T' is transposed</td>
</tr>

<tr>
<td class="org-left"><code>TransB</code></td>
<td class="org-left"><code>char</code></td>
<td class="org-left">in</td>
<td class="org-left">'T' is transposed</td>
</tr>

<tr>
<td class="org-left"><code>m</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>k</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>alpha</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">&alpha;</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>double[][lda]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>size_max_A</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Size of the matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>lda</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>A</code></td>
</tr>

<tr>
<td class="org-left"><code>B</code></td>
<td class="org-left"><code>double[][ldb]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the matrix \(B\)</td>
</tr>

<tr>
<td class="org-left"><code>size_max_B</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Size of the matrix \(B\)</td>
</tr>

<tr>
<td class="org-left"><code>ldb</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>B</code></td>
</tr>

<tr>
<td class="org-left"><code>beta</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">&beta;</td>
</tr>

<tr>
<td class="org-left"><code>C</code></td>
<td class="org-left"><code>double[][ldc]</code></td>
<td class="org-left">out</td>
<td class="org-left">Array containing the matrix \(C\)</td>
</tr>

<tr>
<td class="org-left"><code>size_max_C</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Size of the matrix \(C\)</td>
</tr>

<tr>
<td class="org-left"><code>ldc</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>C</code></td>
</tr>
</tbody>
</table>

<p>
Requirements:
</p>

<ul class="org-ul">
<li><code>context</code> is not <code>QMCKL_NULL_CONTEXT</code></li>
<li><code>m &gt; 0</code></li>
<li><code>n &gt; 0</code></li>
<li><code>k &gt; 0</code></li>
<li><code>lda &gt;= m</code></li>
<li><code>ldb &gt;= n</code></li>
<li><code>ldc &gt;= n</code></li>
<li><code>A</code> is allocated with at least \(m \times k \times 8\) bytes</li>
<li><code>B</code> is allocated with at least \(k \times n \times 8\) bytes</li>
<li><code>C</code> is allocated with at least \(m \times n \times 8\) bytes</li>
<li><code>size_max_A &gt;= m * k</code></li>
<li><code>size_max_B &gt;= k * n</code></li>
<li><code>size_max_C &gt;= m * n</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span> <span style="color: #0000ff;">qmckl_dgemm_safe</span> (
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">TransA</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">TransB</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">m</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">n</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">k</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">alpha</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max_A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">lda</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">B</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max_B</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">ldb</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">beta</span>,
      <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">C</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max_C</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">ldc</span> ); 
</pre>
</div>
</div>
</div>

<div id="outline-container-org88e72a6" class="outline-3">
<h3 id="org88e72a6"><span class="section-number-3">2.3.</span> <code>qmckl_matmul</code></h3>
<div class="outline-text-3" id="text-2-3">
<p>
Matrix multiplication using the <code>qmckl_matrix</code> data type:
</p>

<p>
\[
   C_{ij} = \beta C_{ij} + \alpha \sum_{k} A_{ik} \cdot B_{kj}
   \]
</p>

<table id="orgd6daca1" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>TransA</code></td>
<td class="org-left"><code>char</code></td>
<td class="org-left">in</td>
<td class="org-left">'T' is transposed</td>
</tr>

<tr>
<td class="org-left"><code>TransB</code></td>
<td class="org-left"><code>char</code></td>
<td class="org-left">in</td>
<td class="org-left">'T' is transposed</td>
</tr>

<tr>
<td class="org-left"><code>alpha</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">&alpha;</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>qmckl_matrix</code></td>
<td class="org-left">in</td>
<td class="org-left">Matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>B</code></td>
<td class="org-left"><code>qmckl_matrix</code></td>
<td class="org-left">in</td>
<td class="org-left">Matrix \(B\)</td>
</tr>

<tr>
<td class="org-left"><code>beta</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">&beta;</td>
</tr>

<tr>
<td class="org-left"><code>C</code></td>
<td class="org-left"><code>qmckl_matrix</code></td>
<td class="org-left">out</td>
<td class="org-left">Matrix \(C\)</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span> <span style="color: #0000ff;">qmckl_matmul</span> (
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">TransA</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">TransB</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">alpha</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_matrix</span> <span style="color: #a0522d;">B</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">beta</span>,
      <span style="color: #228b22;">qmckl_matrix</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">C</span> ); 
</pre>
</div>
</div>
</div>

<div id="outline-container-org14347f7" class="outline-3">
<h3 id="org14347f7"><span class="section-number-3">2.4.</span> <code>qmckl_adjugate</code></h3>
<div class="outline-text-3" id="text-2-4">
<p>
Given a matrix \(\mathbf{A}\), the adjugate matrix
\(\text{adj}(\mathbf{A})\) is the transpose of the cofactors matrix
of \(\mathbf{A}\).
</p>

<p>
\[
   \mathbf{B} = \text{adj}(\mathbf{A}) = \text{det}(\mathbf{A}) \, \mathbf{A}^{-1}
   \]
</p>

<p>
See also: <a href="https://en.wikipedia.org/wiki/Adjugate_matrix">https://en.wikipedia.org/wiki/Adjugate_matrix</a>
</p>

<table id="orgd45931a" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows and columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>double[][lda]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the \(n \times n\) matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>lda</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>A</code></td>
</tr>

<tr>
<td class="org-left"><code>B</code></td>
<td class="org-left"><code>double[][ldb]</code></td>
<td class="org-left">out</td>
<td class="org-left">Adjugate of \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>ldb</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>B</code></td>
</tr>

<tr>
<td class="org-left"><code>det_l</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">inout</td>
<td class="org-left">determinant of \(A\)</td>
</tr>
</tbody>
</table>

<p>
Requirements:
</p>

<ul class="org-ul">
<li><code>context</code> is not <code>QMCKL_NULL_CONTEXT</code></li>
<li><code>n &gt; 0</code></li>
<li><code>lda &gt;= m</code></li>
<li><code>A</code> is allocated with at least \(m \times m \times 8\) bytes</li>
<li><code>ldb &gt;= m</code></li>
<li><code>B</code> is allocated with at least \(m \times m \times 8\) bytes</li>
</ul>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span> <span style="color: #0000ff;">qmckl_adjugate</span> (
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">n</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">lda</span>,
      <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">B</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">ldb</span>,
      <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">det_l</span> ); 
</pre>
</div>

<p>
For small matrices (&le; 5&times; 5), we use specialized routines
for performance motivations. For larger sizes, we rely on the
LAPACK library.
</p>

<div class="org-src-container">
<pre class="src src-f90"><span style="color: #a020f0;">subroutine</span> <span style="color: #0000ff;">adjugate_general</span>(context, na, A, LDA, B, LDB, det_l)
  <span style="color: #a020f0;">use</span> <span style="color: #0000ff;">qmckl</span>
  <span style="color: #a020f0;">implicit</span> <span style="color: #228b22;">none</span>
  <span style="color: #228b22;">integer</span>(qmckl_context), <span style="color: #a020f0;">intent</span>(in) ::<span style="color: #a0522d;"> context</span>
  <span style="color: #228b22;">integer</span>*8, <span style="color: #a020f0;">intent</span>(in)              ::<span style="color: #a0522d;"> LDA</span>
  <span style="color: #228b22;">integer</span>*8, <span style="color: #a020f0;">intent</span>(in)              ::<span style="color: #a0522d;"> LDB</span>
  <span style="color: #228b22;">integer</span>*8, <span style="color: #a020f0;">intent</span>(in)              ::<span style="color: #a0522d;"> na</span>
  <span style="color: #228b22;">double precision</span>, <span style="color: #a020f0;">intent</span>(in)       ::<span style="color: #a0522d;"> A (LDA,na)</span>
  <span style="color: #228b22;">double precision</span>, <span style="color: #a020f0;">intent</span>(out)      ::<span style="color: #a0522d;"> B (LDB,na)</span>
  <span style="color: #228b22;">double precision</span>, <span style="color: #a020f0;">intent</span>(inout)    ::<span style="color: #a0522d;"> det_l</span>

  <span style="color: #228b22;">double precision</span> ::<span style="color: #a0522d;"> work(LDA*max(na,64))</span>
  <span style="color: #228b22;">integer</span>          ::<span style="color: #a0522d;"> inf</span>
  <span style="color: #228b22;">integer</span>          ::<span style="color: #a0522d;"> ipiv(LDA)</span>
  <span style="color: #228b22;">integer</span>          ::<span style="color: #a0522d;"> lwork</span>
  <span style="color: #228b22;">integer</span>(8)       ::<span style="color: #a0522d;"> i, j</span>

</pre>
</div>

<p>
We first copy the array <code>A</code> into array <code>B</code>.
</p>

<div class="org-src-container">
<pre class="src src-f90">B(1:na,1:na) = A(1:na,1:na)
</pre>
</div>

<p>
Then, we compute the LU factorization \(LU=A\)
using the <code>dgetrf</code> routine.
</p>

<div class="org-src-container">
<pre class="src src-f90"><span style="color: #a020f0;">call</span> <span style="color: #0000ff;">dgetrf</span>(na, na, B, LDB, ipiv, inf )
</pre>
</div>

<p>
By convention, the determinant of \(L\) is equal to one, so the
determinant of \(A\) is equal to the determinant of \(U\), which is
simply computed as the product of its diagonal elements.
</p>

<div class="org-src-container">
<pre class="src src-f90">det_l = 1.d0
j=0_8
<span style="color: #a020f0;">do</span> i=1,na
 j = j+<span style="color: #a020f0;">min</span>(<span style="color: #a020f0;">abs</span>(ipiv(i)-i),1)
 det_l = det_l*B(i,i)
<span style="color: #a020f0;">enddo</span>
</pre>
</div>

<p>
As <code>dgetrf</code> returns \(PLU=A\) where \(P\) is a permutation matrix, the
sign of the determinant is computed as \(-1^m\) where \(m\) is the
number of permutations.
</p>

<div class="org-src-container">
<pre class="src src-f90"><span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">iand</span>(j,1_8) /= 0_8)  <span style="color: #a020f0;">then</span>
  det_l = -det_l
<span style="color: #a020f0;">endif</span>
</pre>
</div>

<p>
Then, the inverse of \(A\) is computed using <code>dgetri</code>:
</p>

<div class="org-src-container">
<pre class="src src-f90">lwork = <span style="color: #a020f0;">SIZE</span>(work)
<span style="color: #a020f0;">call</span> <span style="color: #0000ff;">dgetri</span>(na, B, LDB, ipiv, work, lwork, inf )
</pre>
</div>

<p>
and the adjugate matrix is computed as the product of the
determinant with the inverse:
</p>

<div class="org-src-container">
<pre class="src src-f90">  B(1:na,1:na) = B(1:na,1:na)*det_l

<span style="color: #a020f0;">end subroutine</span> <span style="color: #0000ff;">adjugate_general</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a203eb" class="outline-3">
<h3 id="org5a203eb"><span class="section-number-3">2.5.</span> <code>qmckl_adjugate_safe</code></h3>
<div class="outline-text-3" id="text-2-5">
<p>
"Size-safe" proxy function with the same functionality as <code>qmckl_adjugate</code>
but with 2 additional arguments. These arguments <code>size_max_M</code> (where <code>M</code> is a matix)
are required primarily for the Python API, where compatibility with
NumPy arrays implies that sizes of the input and output arrays are provided.
</p>


<table id="org762a156" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows and columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>double[][lda]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the \(n \times n\) matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>size_max_A</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Size of the matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>lda</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>A</code></td>
</tr>

<tr>
<td class="org-left"><code>B</code></td>
<td class="org-left"><code>double[][ldb]</code></td>
<td class="org-left">out</td>
<td class="org-left">Adjugate of \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>size_max_B</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Size of the matrix \(B\)</td>
</tr>

<tr>
<td class="org-left"><code>ldb</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>B</code></td>
</tr>

<tr>
<td class="org-left"><code>det_l</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">inout</td>
<td class="org-left">determinant of \(A\)</td>
</tr>
</tbody>
</table>

<p>
Requirements:
</p>

<ul class="org-ul">
<li><code>context</code> is not <code>QMCKL_NULL_CONTEXT</code></li>
<li><code>n &gt; 0</code></li>
<li><code>lda &gt;= m</code></li>
<li><code>A</code> is allocated with at least \(m \times m \times 8\) bytes</li>
<li><code>ldb &gt;= m</code></li>
<li><code>B</code> is allocated with at least \(m \times m \times 8\) bytes</li>
<li><code>size_max_A &gt;= m * m</code></li>
<li><code>size_max_B &gt;= m * m</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span> <span style="color: #0000ff;">qmckl_adjugate_safe</span> (
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">n</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max_A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">lda</span>,
      <span style="color: #228b22;">double</span>* <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">B</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">size_max_B</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">ldb</span>,
      <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">det_l</span> ); 
</pre>
</div>

<p>
For small matrices (&le; 5&times; 5), we use specialized routines
for performance motivations. For larger sizes, we rely on the
LAPACK library.
</p>
</div>

<div id="outline-container-org871eb4c" class="outline-4">
<h4 id="org871eb4c"><span class="section-number-4">2.5.1.</span> C interface</h4>
</div>
</div>

<div id="outline-container-orga82ba36" class="outline-3">
<h3 id="orga82ba36"><span class="section-number-3">2.6.</span> <code>qmckl_transpose</code></h3>
<div class="outline-text-3" id="text-2-6">
<p>
Transposes a matrix: \(A^\dagger_{ji} = A_{ij}\).
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>qmckl_matrix</code></td>
<td class="org-left">in</td>
<td class="org-left">Input matrix</td>
</tr>

<tr>
<td class="org-left"><code>At</code></td>
<td class="org-left"><code>qmckl_matrix</code></td>
<td class="org-left">out</td>
<td class="org-left">Transposed matrix</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org5663513" class="outline-3">
<h3 id="org5663513"><span class="section-number-3">2.7.</span> <code>qmckl_dgemm_sparse_nn</code></h3>
<div class="outline-text-3" id="text-2-7">
<p>
Sparse matrix multiplication using CSR (Compressed Sparse Row) format for both matrices:
</p>

<p>
\[
   C_{ij} = \beta C_{ij} + \alpha \sum_{k} A_{ik} \cdot B_{kj}
   \]
</p>

<p>
This function performs matrix multiplication where both \(A\) and \(B\) are stored in
CSR (Compressed Sparse Row) format. The function automatically switches between
sparse and dense BLAS implementations based on the matrix density threshold.
</p>

<table id="org4319c12" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>m</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows of matrix \(A\) and \(C\)</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of matrix \(B\) and \(C\)</td>
</tr>

<tr>
<td class="org-left"><code>k</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of \(A\) and rows of \(B\)</td>
</tr>

<tr>
<td class="org-left"><code>alpha</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">Scalar \(\alpha\)</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>CSRMatrix*</code></td>
<td class="org-left">in</td>
<td class="org-left">CSR format sparse matrix \(A\) (\(m \times k\))</td>
</tr>

<tr>
<td class="org-left"><code>B</code></td>
<td class="org-left"><code>CSRMatrix*</code></td>
<td class="org-left">in</td>
<td class="org-left">CSR format sparse matrix \(B\) (\(k \times n\))</td>
</tr>

<tr>
<td class="org-left"><code>beta</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">Scalar \(\beta\)</td>
</tr>

<tr>
<td class="org-left"><code>C</code></td>
<td class="org-left"><code>double*</code></td>
<td class="org-left">out</td>
<td class="org-left">Dense output matrix \(C\) (\(m \times n\))</td>
</tr>

<tr>
<td class="org-left"><code>ldc</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>C</code></td>
</tr>
</tbody>
</table>

<p>
Requirements:
</p>

<ul class="org-ul">
<li><code>context</code> is not <code>QMCKL_NULL_CONTEXT</code></li>
<li><code>m &gt; 0</code></li>
<li><code>n &gt; 0</code></li>
<li><code>k &gt; 0</code></li>
<li><code>A</code> is not <code>NULL</code> and properly initialized as CSR matrix</li>
<li><code>B</code> is not <code>NULL</code> and properly initialized as CSR matrix</li>
<li><code>C</code> is allocated with at least \(m \times n\) elements</li>
<li><code>ldc &gt;= m</code></li>
</ul>
</div>
</div>

<div id="outline-container-org012384f" class="outline-3">
<h3 id="org012384f"><span class="section-number-3">2.8.</span> <code>qmckl_dgemm_sparse_b_nn</code></h3>
<div class="outline-text-3" id="text-2-8">
<p>
Sparse matrix multiplication where \(A\) is dense and \(B\) is in CSC (Compressed Sparse Column) format:
</p>

<p>
\[
   C_{ij} = \beta C_{ij} + \alpha \sum_{k} A_{ik} \cdot B_{kj}
   \]
</p>

<p>
This function performs matrix multiplication where \(A\) is a dense matrix and \(B\) is stored
in CSC (Compressed Sparse Column) format. The function automatically switches between
sparse and dense BLAS implementations based on the matrix \(B\) density threshold.
</p>

<table id="org0c54dec" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>m</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows of matrix \(A\) and \(C\)</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of matrix \(B\) and \(C\)</td>
</tr>

<tr>
<td class="org-left"><code>k</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of \(A\) and rows of \(B\)</td>
</tr>

<tr>
<td class="org-left"><code>alpha</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">Scalar \(\alpha\)</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>double*</code></td>
<td class="org-left">in</td>
<td class="org-left">Dense matrix \(A\) (\(m \times k\))</td>
</tr>

<tr>
<td class="org-left"><code>LDA</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>A</code></td>
</tr>

<tr>
<td class="org-left"><code>B</code></td>
<td class="org-left"><code>CSCMatrix*</code></td>
<td class="org-left">in</td>
<td class="org-left">CSC format sparse matrix \(B\) (\(k \times n\))</td>
</tr>

<tr>
<td class="org-left"><code>beta</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">Scalar \(\beta\)</td>
</tr>

<tr>
<td class="org-left"><code>C</code></td>
<td class="org-left"><code>double*</code></td>
<td class="org-left">out</td>
<td class="org-left">Dense output matrix \(C\) (\(m \times n\))</td>
</tr>

<tr>
<td class="org-left"><code>ldc</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>C</code></td>
</tr>
</tbody>
</table>

<p>
Requirements:
</p>

<ul class="org-ul">
<li><code>context</code> is not <code>QMCKL_NULL_CONTEXT</code></li>
<li><code>m &gt; 0</code></li>
<li><code>n &gt; 0</code></li>
<li><code>k &gt; 0</code></li>
<li><code>A</code> is not <code>NULL</code> and allocated with at least \(m \times k\) elements</li>
<li><code>LDA &gt;= m</code></li>
<li><code>B</code> is not <code>NULL</code> and properly initialized as CSC matrix</li>
<li><code>C</code> is allocated with at least \(m \times n\) elements</li>
<li><code>ldc &gt;= m</code></li>
</ul>
</div>
</div>

<div id="outline-container-orge82d772" class="outline-3">
<h3 id="orge82d772"><span class="section-number-3">2.9.</span> <code>qmckl_dgemv</code></h3>
<div class="outline-text-3" id="text-2-9">
<p>
Matrix-vector multiplication with a BLAS interface:
</p>

<p>
\[
   Y_{i} = \sum_{j} \alpha A_{ij} X_j + \beta Y_i
   \]
</p>

<table id="orgc6a8dcb" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>Trans</code></td>
<td class="org-left"><code>char</code></td>
<td class="org-left">in</td>
<td class="org-left">'T' is transposed</td>
</tr>

<tr>
<td class="org-left"><code>m</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>alpha</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">\(\alpha\)</td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>double[][lda]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>lda</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>A</code></td>
</tr>

<tr>
<td class="org-left"><code>X</code></td>
<td class="org-left"><code>double[]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the vector \(x\)</td>
</tr>

<tr>
<td class="org-left"><code>incx</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Increment of the elements of <code>x</code></td>
</tr>

<tr>
<td class="org-left"><code>beta</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">\(\beta\)</td>
</tr>

<tr>
<td class="org-left"><code>y</code></td>
<td class="org-left"><code>double[]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the vector \(y\)</td>
</tr>

<tr>
<td class="org-left"><code>incy</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Increment of the elements of <code>y</code></td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span> <span style="color: #0000ff;">qmckl_dgemv</span> (
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">Trans</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">m</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">n</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">alpha</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">lda</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">X</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">incx</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">beta</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">y</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">incy</span> ); 
</pre>
</div>
</div>
</div>

<div id="outline-container-org7204053" class="outline-3">
<h3 id="org7204053"><span class="section-number-3">2.10.</span> <code>qmckl_dger</code></h3>
<div class="outline-text-3" id="text-2-10">
<p>
Rank-1 update
</p>

<p>
\[
   A = \alpha x y^{\dagger} + A
   \]
</p>

<table id="orga1414cc" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Type</th>
<th scope="col" class="org-left">In/Out</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>context</code></td>
<td class="org-left"><code>qmckl_context</code></td>
<td class="org-left">in</td>
<td class="org-left">Global state</td>
</tr>

<tr>
<td class="org-left"><code>m</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of rows of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>n</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Number of columns of the input matrix</td>
</tr>

<tr>
<td class="org-left"><code>alpha</code></td>
<td class="org-left"><code>double</code></td>
<td class="org-left">in</td>
<td class="org-left">\(\alpha\)</td>
</tr>

<tr>
<td class="org-left"><code>X</code></td>
<td class="org-left"><code>double[]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the vector \(x\)</td>
</tr>

<tr>
<td class="org-left"><code>incx</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Increment of the elements of <code>x</code></td>
</tr>

<tr>
<td class="org-left"><code>y</code></td>
<td class="org-left"><code>double[]</code></td>
<td class="org-left">in</td>
<td class="org-left">Array containing the vector \(y\)</td>
</tr>

<tr>
<td class="org-left"><code>incy</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Increment of the elements of <code>y</code></td>
</tr>

<tr>
<td class="org-left"><code>A</code></td>
<td class="org-left"><code>double[][lda]</code></td>
<td class="org-left">inout</td>
<td class="org-left">Array containing the matrix \(A\)</td>
</tr>

<tr>
<td class="org-left"><code>lda</code></td>
<td class="org-left"><code>int64_t</code></td>
<td class="org-left">in</td>
<td class="org-left">Leading dimension of array <code>A</code></td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #228b22;">qmckl_exit_code</span> <span style="color: #0000ff;">qmckl_dger</span> (
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">qmckl_context</span> <span style="color: #a0522d;">context</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">m</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">n</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">alpha</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">X</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">incx</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">y</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">incy</span>,
      <span style="color: #228b22;">double</span>* <span style="color: #a0522d;">A</span>,
      <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int64_t</span> <span style="color: #a0522d;">lda</span> ); 
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org252c536" class="outline-2">
<h2 id="org252c536"><span class="section-number-2">3.</span> Utilities</h2>
<div class="outline-text-2" id="text-3">
<p>
Trick to make MKL efficient on AMD
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: TREX CoE</p>
<p class="date">Created: 2025-12-15 Mon 16:47</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
